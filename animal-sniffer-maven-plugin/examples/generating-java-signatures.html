<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-08-02 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Stephen Connolly" />
    <meta name="Date-Creation-yyyymmdd" content="20100310" />
    <meta name="Date-Revision-yyyymmdd" content="20150802" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Animal Sniffer Maven Plugin &#x2013; Generating signatures of the Java Runtime</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.4.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/mojohaus/mojo-parent">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../../" id="bannerLeft">
                                                                                                <img src="../../../images/mojo_logo.png"  alt="MojoHaus"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../../" title="MojoHaus">
        MojoHaus</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../../../mojo-parent" title="MojoHaus Parent">
        MojoHaus Parent</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../../" title="Animal Sniffer">
        Animal Sniffer</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../" title="Animal Sniffer Maven plugin">
        Animal Sniffer Maven plugin</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Generating signatures of the Java Runtime</li>
        
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2015-08-02</li>
              <li id="projectVersion" class="pull-right">
                      <span class="divider">|</span>
                    Version: 1.15-SNAPSHOT
        </li>
            
                                    
    <li class="pull-right">
                      <a href="http://maven.apache.org/" class="externalLink" title="Maven">
        Maven</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../../index.html" title="Codehaus Mojo Parent">
          <span class="none"></span>
        Codehaus Mojo Parent</a>
            </li>
                
      <li>
  
                          <a href="../../animal-sniffer/index.html" title="Animal Sniffer Parent project">
          <span class="none"></span>
        Animal Sniffer Parent project</a>
            </li>
                              <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="../index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="../usage.html" title="Usage">
          <span class="none"></span>
        Usage</a>
            </li>
                
      <li>
  
                          <a href="../faq.html" title="Frequently Asked Questions">
          <span class="none"></span>
        Frequently Asked Questions</a>
            </li>
                              <li class="nav-header">Examples</li>
                              
      <li>
  
                          <a href="../examples/checking-signatures.html" title="Checking a project against API signatures">
          <span class="none"></span>
        Checking a project against API signatures</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Generating signatures of the Java Runtime</a>
          </li>
                
      <li>
  
                          <a href="../examples/generating-other-api-signatures.html" title="Generating signatures of other APIs">
          <span class="none"></span>
        Generating signatures of other APIs</a>
            </li>
                                        <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                        
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="www.mojohaus.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- The MIT License --><!--  --><!-- Copyright (c) 2009 codehaus.org. --><!--  --><!-- Permission is hereby granted, free of charge, to any person obtaining a copy --><!-- of this software and associated documentation files (the "Software"), to deal --><!-- in the Software without restriction, including without limitation the rights --><!-- to use, copy, modify, merge, publish, distribute, sublicense, and/or sell --><!-- copies of the Software, and to permit persons to whom the Software is --><!-- furnished to do so, subject to the following conditions: --><!--  --><!-- The above copyright notice and this permission notice shall be included in --><!-- all copies or substantial portions of the Software. --><!--  --><!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR --><!-- IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, --><!-- FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE --><!-- AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER --><!-- LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, --><!-- OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN --><!-- THE SOFTWARE. --><!--  --><div class="section">
<h2><a name="Generating_signatures_of_the_Java_Runtime"></a>Generating signatures of the Java Runtime</h2>
<div class="section">
<h3><a name="Basic"></a>Basic</h3>
<p>To generate signatures of any API, you simple construct a project with the appropriate dependencies exposed by the API and then add an execution of the <tt>animal-sniffer:build</tt> goal to your project. In the case of the Java Runtime, this is a project with no dependencies, e.g.</p>
<div>
<pre>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;____&lt;/groupId&gt;
  &lt;artifactId&gt;____&lt;/artifactId&gt;
  &lt;version&gt;____&lt;/version&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;___id of execution___&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;build&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div>
<p>Then you just build this project with the appropriate Java Runtime, and it will generate the signatures of that Java Runtime.</p>
<p>The observant reader may have spotted that it may not always be possible to run Maven with the Java Runtime that you want to generate the signatures of. In these cases you have a number of solutions:</p>
<ul>
<li>Use Maven Toolchains support and the <tt>jdk</tt> parameter to define what toolchain you require. This will use automatic boot classpath detection, which does not work for Java 1.1 or earlier and may not work on some exotic Java Runtimes.
<p>An example of using the <tt>jdk</tt> parameter is:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;jdk&gt;
            &lt;version&gt;[1.6.0,1.6.1)&lt;/version&gt;
            &lt;vendor&gt;sun&lt;/vendor&gt;
          &lt;/jdk&gt;
          ...
        &lt;/configuration&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></li>
<li>Use the <tt>javaHome</tt> parameter to specify the Java Home that you want to generate the signatures of. This will use automatic boot classpath detection, which does not work for Java 1.1 or earlier and may not work on some exotic Java Runtimes.
<p>An example of using the <tt>javaHome</tt> parameter is:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;javaHome&gt;C:\Program Files\Java\jdk_1.6.0_14&lt;/javaHome&gt;
          ...
        &lt;/configuration&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></li>
<li>Use the <tt>javaHomeClassPath</tt> parameter to specify the exact classpath to generate the signatures of. This is the only way to specify the Java Runtime when automatic boot classpath detection fails.
<p>An example of this technique is:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;javaHomeClassPath&gt;
            &lt;javaHomeClassPath&gt;C:\Program Files\Java\jdk_1.6.0_14\jre\lib\rt.jar&lt;/javaHomeClassPath&gt;
            &lt;javaHomeClassPath&gt;C:\Program Files\Java\jdk_1.6.0_14\jre\lib\jsse.jar&lt;/javaHomeClassPath&gt;
          &lt;/javaHomeClassPath&gt;
          ...
        &lt;/configuration&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></li></ul></div>
<div class="section">
<h3><a name="Generating_pure_signatures"></a>Generating &quot;pure&quot; signatures</h3>
<p>The above examples generate signatures of the entire classpath of the JRE. That will include all the implementation classes which are not part of the public contract of the JRE. For example sun.misc.BASE64Encoder is part of Sun's JRE runtime libraries, but is not part of the JRE specification and if you run on a JRE produced by a different vendor, it is highly likely that that class will not be available to your program.</p>
<p>In order to ensure that the Java signatures you generate only include those classes which are officially published by the JRE, you will need to tune your signatures.</p>
<div class="section">
<h4><a name="Inclusion_based_tuning"></a>Inclusion based tuning</h4>
<p>One technique is to only include those classes which you know are part of the JRE public specification. For example:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;jdk&gt;
            &lt;version&gt;[1.4.0,1.5.0)&lt;/version&gt;
          &lt;/jdk&gt;
          &lt;includeClasses&gt;
            &lt;includeClass&gt;java.*&lt;/includeClass&gt;
            &lt;includeClass&gt;javax.*&lt;/includeClass&gt;
            &lt;includeClass&gt;org.omg.*&lt;/includeClass&gt;
            &lt;includeClass&gt;org.w3c.dom.*&lt;/includeClass&gt;
            &lt;!-- etc --&gt;
            ...
          &lt;/includeClasses&gt;
          ...
        &lt;/configuration&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div>
<p>This requires that you known exactly what classes are part of the JRE specification.</p></div>
<div class="section">
<h4><a name="Exclusion_based_tuning"></a>Exclusion based tuning</h4>
<p>The other technique is to specify which classes are not to be included. Note that a combination of the two can also be used. For example:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;jdk&gt;
            &lt;version&gt;[1.4.0,1.5.0)&lt;/version&gt;
          &lt;/jdk&gt;
          &lt;excludeClasses&gt;
            &lt;excludeClass&gt;com.sun.*&lt;/excludeClass&gt;
            &lt;excludeClass&gt;sun.*&lt;/excludeClass&gt;
            &lt;!-- etc --&gt;
            ...
          &lt;/excludeClasses&gt;
          ...
        &lt;/configuration&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></div></div>
<div class="section">
<h3><a name="When_the_version_of_Java_you_require_is_not_available"></a>When the version of Java you require is not available</h3>
<p>By default, if the version of Java that you require is not available, the animal-sniffer plugin will fail the build. If you are generating multiple signatures, this may not be exactly what you want. For example you may be generating signatures for JREs on Windows, Linux and MacOS from the same project. This would require building the same project at least three times and setting the <tt>skipIfNoJavaHome</tt> option to <tt>true</tt> for example</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;skipIfNoJavaHome&gt;true&lt;/skipIfNoJavaHome&gt;
          ...
        &lt;/configuration&gt;
        ...
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;windows&lt;/id&gt;
            ...
            &lt;configuration&gt;
              ...
              &lt;classifier&gt;windows&lt;/classifier&gt;
              &lt;jdk&gt;
                &lt;version&gt;[1.4.0,1.5.0)&lt;/version&gt;
                &lt;os&gt;windows&lt;/os&gt;
              &lt;/jdk&gt;
              ...
            &lt;/configuration&gt;
            ...
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;linux
            ...
            &lt;configuration&gt;
              ...
              &lt;classifier&gt;linux&lt;/classifier&gt;
              &lt;jdk&gt;
                &lt;version&gt;[1.4.0,1.5.0)&lt;/version&gt;
                &lt;os&gt;linux&lt;/os&gt;
              &lt;/jdk&gt;
              ...
            &lt;/configuration&gt;
            ...
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></div>
<div class="section">
<h3><a name="Automatic_boot_classpath_detection"></a>Automatic boot classpath detection</h3>
<p>Animal sniffer uses a helper module to try and determine the boot classpath of the Java Home that has been specified. This can be done in one of two ways:</p>
<ul>
<li>Indirectly via a toolchain reference using the <tt>jdk</tt> configuration option</li>
<li>Directly using the <tt>javaHome</tt> option</li></ul>
<p>The <a href="../../animal-sniffer/java-boot-classpath-detector/">helper module</a> should work for most common versions of Java providing they are at least Java 1.2.</p>
<p>If the default helper module does not work for the version of Java that you need to generate signatures of, you can replace the helper module with your own module. The replacement module must meet the following specification:</p>
<ul>
<li>Must be an executable JAR file</li>
<li>If the Java boot classpath cannot be detected, it must return with exit code 1.</li>
<li>If the Java boot classpath has been detected, it must print the boot class path to <tt>stdout</tt> as a single line with each element of the boot classpath separated from the next using <tt>File.pathSeparator</tt> and return with exit code 0.</li></ul>
<p>When invoking the helper module, animal-sniffer will:</p>
<ul>
<li>Clear the CLASSPATH environment variable in the forked execution environment.</li>
<li>Clear the JAVA_HOME environment variable in the forked execution environment.</li>
<li>Invoke the <tt>java</tt> command in the <tt>javaHome</tt> or <tt>jdk</tt> that has been configured with the options <tt>-jar</tt> and the full path to the Java boot classpath detector module specified in the configuration of the animal-sniffer plugin. Note: this module JAR file will be located in the Maven local repository.</li></ul>
<p>A replacement module must be added to the <tt>dependencies</tt> section of <i>the Animal Sniffer Plugin</i> and the groupId and artifactId must be configured using the <tt>jbcpdGroupId</tt> and <tt>jbcpdArtifactId</tt> configuration options. For example, if your custom boot classpath detector is com.mycompany:detect-boot-classpath:1.2.0:jar then you could configure animal-sniffer to use this with the following:</p>
<div>
<pre>&lt;project&gt;
  ...
  &lt;build&gt;
    ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;animal-sniffer-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15-SNAPSHOT&lt;/version&gt;
        ...
        &lt;configuration&gt;
          ...
          &lt;jbcpdGroupId&gt;com.mycompany&lt;/jbcpdGroupId&gt;
          &lt;jbcpdArtifactId&gt;detect-boot-classpath&lt;/jbcpdArtifactId&gt;
          ...
        &lt;/configuration&gt;
        ...
        &lt;dependencies&gt;
          ...
          &lt;dependency&gt;
            &lt;groupId&gt;com.mycompany&lt;/groupId&gt;
            &lt;artifactId&gt;detect-boot-classpath&lt;/artifactId&gt;
            &lt;version&gt;1.2.0&lt;/version&gt;
          &lt;/dependency&gt;
          ...
        &lt;/dependencies&gt;
        ...
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
    ...
  &lt;/build&gt;
  ...
&lt;/project&gt;</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2008&#x2013;2015
                        <a href="http://www.mojohaus.org">MojoHaus</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="https://www.ohloh.net/p/5211/widgets/project_thin_badge.js"></script>
    </div>
        </div>
    </footer>
        </body>
</html>